import requests
import pandas as pd

# Define variables
contrast_token = 'dhdjdjdjdjrjrjrjdj=='
OrgUUid = 'gshdhdhd'
App_Id = 'hdj-jdjdjd-7788-jdjdjdj'  # Extracted from the list as a single string
api_key = 'hhjkkjdddjdkdk'

# Construct the API URL
base_url = 'https://contrast.crm.com/Contrast/api/ng/'
url = f"{base_url}{OrgUUid}/applications/{App_Id}/servers"

# Define headers using the contrast_token variable
contrast_headers = {
    'Authorization': contrast_token,
    'Api-key': api_key,
    'Accept': 'application/json'
}

# Make the GET request to the API
response = requests.get(url, headers=contrast_headers)

# Check if the request was successful
if response.status_code == 200:
    # Parse the JSON response
    data = response.json()
    # Assume the data contains a 'servers' key with a list of server objects
    servers = data.get('servers', [])
    
    # Define the fields to extract
    required_fields = ['environment', 'status', 'server_id', 'name', 'agent_version']
    
    # Extract the required fields from each server
    extracted_data = []
    for server in servers:
        row = {field: server.get(field, '') for field in required_fields}
        extracted_data.append(row)
    
    # Create a pandas DataFrame from the extracted data
    df = pd.DataFrame(extracted_data)
    
    # Save the DataFrame to an Excel file
    df.to_excel('Data.xlsx', index=False)
    print("Data successfully saved to Data.xlsx")
else:
    # Handle errors if the request fails
    print(f"Error: {response.status_code} - {response.text}")